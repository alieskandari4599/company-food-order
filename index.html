<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø³ÙØ§Ø±Ø´ ØºØ°Ø§ÛŒ Ø´Ø±Ú©ØªÛŒ - Ù…Ø§Ù‡Ø§Ù†Ù‡</title>
<link rel="icon" href="logo.png" />
<style>
  :root{
    --bg:#0f172a; --card:rgba(255,255,255,.08); --card-border:rgba(255,255,255,.18);
    --text:#e6edf6; --muted:#b6c2d9; --accent:#22c55e; --accent-strong:#16a34a;
    --danger:#ef4444; --shadow:0 10px 30px rgba(0,0,0,.25); --radius:18px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Tahoma,system-ui;background:var(--bg);color:var(--text);line-height:1.7;}
  header{
    padding:16px;text-align:center;background:#1e293b;color:#fff;font-weight:800;letter-spacing:.2px;
    display:flex;flex-direction:column;align-items:center;gap:8px
  }
  header .logo{width:84px;height:auto;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.4)}
  header h1{margin:0;font-size:20px}
  .subhead{font-size:13px;color:#cbd5e1;margin-top:4px}
  #whoAmI{color:var(--muted);font-size:14px;margin-top:6px}
  .container{max-width:1100px;margin:24px auto;padding:0 18px}
  .card{
    background:var(--card);border:1px solid var(--card-border);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:24px;margin:14px auto;text-align:center
  }
  h2{margin:6px 0 16px}
  .muted{color:var(--muted)}
  .row{display:grid;gap:12px}
  .two-col{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  @media (max-width:900px){.two-col{grid-template-columns:1fr}}
  .grid-day{display:grid;gap:12px;grid-template-columns:220px 1fr 1fr}
  @media (max-width:800px){.grid-day{grid-template-columns:1fr}}
  .input,.select,.button{
    width:100%;padding:12px 14px;font-size:16px;border-radius:12px;border:1px solid var(--card-border);
    background:rgba(255,255,255,.07);color:var(--text);outline:none
  }
  .select{font-weight:700;text-align:center;appearance:none;-webkit-appearance:none}
  .button{cursor:pointer;font-weight:800;background:linear-gradient(180deg,var(--accent),var(--accent-strong));border:none}
  .button:hover{filter:brightness(1.05)}
  .danger{background:linear-gradient(180deg,var(--danger),#b91c1c)!important}
  .badge{
    padding:12px;border-radius:12px;font-weight:800;text-align:center;color:#fff;border:1px solid var(--card-border)
  }
  .badge[data-day*="Ø´Ù†Ø¨Ù‡"]{background:#ef4444}
  .badge[data-day*="ÛŒÚ©Ø´Ù†Ø¨Ù‡"]{background:#f59e0b}
  .badge[data-day*="Ø¯ÙˆØ´Ù†Ø¨Ù‡"]{background:#10b981}
  .badge[data-day*="Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡"]{background:#3b82f6}
  .badge[data-day*="Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡"]{background:#8b5cf6}
  .week-card{
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.06);
    border-radius:12px; padding:12px; margin:10px 0; text-align:right
  }
  .week-title{font-weight:800;margin:0 0 8px}
  .strike{opacity:.55; text-decoration: line-through; filter: grayscale(1)}
  .disabled{pointer-events:none; opacity:.55}
  .ok{color:#34d399}
  .err{color:#ff6b6b}
  .small{font-size:12px;color:#cbd5e1}
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø´Ø±Ú©Øª" class="logo">
  <h1>ğŸ½ï¸ Ø³ÙØ§Ø±Ø´ ØºØ°Ø§ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡</h1>
  <div class="subhead" id="todayBar">Ø§Ù…Ø±ÙˆØ² (Ø´Ù…Ø³ÛŒ): â€¦</div>
  <div id="whoAmI"></div>
</header>

<div class="container">
  <!-- ÙˆØ±ÙˆØ¯ -->
  <div class="card" id="loginDiv">
    <h2>ÙˆØ±ÙˆØ¯</h2>
    <p class="muted">Ú©Ø¯ Ù…Ù„ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. (Ù…Ø¯ÛŒØ±: <b>admin</b>)</p>
    <div class="two-col">
      <input id="userCode" class="input" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 0012345678 ÛŒØ§ admin" />
      <button class="button" onclick="login()">ÙˆØ±ÙˆØ¯</button>
    </div>
    <p id="loginMsg" class="err"></p>
  </div>

  <!-- Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø§Ù‡Ø§Ù†Ù‡ -->
  <div class="card" id="orderDiv" style="display:none;">
    <h2>Ø§Ù†ØªØ®Ø§Ø¨ ØºØ°Ø§ Ø¨Ø±Ø§ÛŒ <span id="monthTitle">Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ</span></h2>
    <p id="helloText" class="muted"></p>
    <div id="monthContainer"></div>
    <div class="two-col" style="margin-top:12px">
      <button class="button" onclick="submitMonthOrder()">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ù…Ø§Ù‡</button>
      <button class="button danger" onclick="logout()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <p id="orderMsg" class="ok"></p>
    <p class="small">* Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø² ÙØ§ÛŒÙ„ <b>menu.json</b> Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
  </div>

  <!-- Ù…Ø¯ÛŒØ±: ÙÙ‚Ø· Ù…Ø´Ø§Ù‡Ø¯Ù‡ JSON Ùˆ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ -->
  <div class="card" id="adminDiv" style="display:none;">
    <h2>Ù…Ù†ÙˆÛŒ Ù…Ø§Ù‡ (Ø®ÙˆØ§Ù†Ø¯Ù‡â€ŒØ´Ø¯Ù‡ Ø§Ø² JSON)</h2>
    <pre id="jsonPreview" style="text-align:left;direction:ltr;max-height:320px;overflow:auto;background:rgba(0,0,0,.3);padding:12px;border-radius:10px"></pre>
    <div class="two-col" style="margin-top:12px">
      <button class="button" onclick="openMenuOnGitHub()">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† menu.json Ø¯Ø± GitHub</button>
      <button class="button" onclick="copyRawMenuLink()">Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ… menu.json</button>
    </div>
    <button class="button danger" style="margin-top:12px" onclick="logout()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
  </div>
</div>

<script>
/* Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€ */
// Ø¢Ø¯Ø±Ø³ RAW ÙØ§ÛŒÙ„ menu.json Ø®ÙˆØ¯Øª Ø±Ø§ Ø¨Ú¯Ø°Ø§Ø±:
const MENU_JSON_URL = "https://raw.githubusercontent.com/alieskandari4599/company-food-order/main/menu.json";

/* Ú©Ø§Ø±Ú©Ù†Ø§Ù† (Ú©Ø§Ù…Ù„) */
const users = [
 {"code":"1465316159","name":"Ø¹Ù„ÛŒ Ø§ØµØºØ±Ø²Ø§Ø¯Ù‡ ØµØ§Ø¯Ù‚","section":"Ø·Ø¨Ù‚Ù‡ 4"},
 {"code":"0939825902","name":"Ø³ÛŒØ¯ Ø¹Ù„ÛŒ Ù…ÛŒØ±ØªÙˆÙ†ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 4"},
 {"code":"0075102110","name":"Ù…Ø­Ø³Ù† Ø§Ø´Ø±Ù Ø§Ø³Ù„Ø§Ù…ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 4"},
 {"code":"1532626142","name":"Ø²Ù‡Ø±Ø§ Ù…Ø­Ù…Ø¯ÛŒ Ø­Ù„Ù…Ø³Ù„ÙˆØ¦ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 4"},
 {"code":"2710033445","name":"Ù…Ø³Ø¹ÙˆØ¯ Ù‚Ø§Ø³Ù… Ø²Ø§Ø¯Ù‡ Ø³ÛŒØ§Ù‡Ú©Ù„","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"1263594301","name":"Ù…Ù‡Ø¯ÛŒ Ù†ÙˆØ±ÙˆØ²ÛŒ Ø®Ø²Ø§Ù‚ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"0010275975","name":"Ù„ÛŒÙ„Ø§ Ø±Ø³ÙˆÙ„ÛŒ Ø¯Ø±Ø¢Ø¨Ø§Ø¯","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"0014668688","name":"Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ø¹Ø¨Ø¯Ø§Ù„Ù‡ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"0051385090","name":"Ø´Ø§Ù‡ÛŒÙ† ÙØ§Ø¶Ù„ Ù…Ù‡Ø±","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"1450551394","name":"ÙØ§Ø·Ù…Ù‡ Ù¾Ø§Ø±Ø³Ø§ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"1263591310","name":"Ù…Ù‚Ø¯Ø§Ø¯ Ø´ÙÙ‚ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"0020090641","name":"ÙØ§Ø·Ù…Ù‡ Ù…ÛŒØ±Ø²Ø§Ø®Ø§Ù†ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"0077320980","name":"Ø¬ÙˆØ§Ø¯ Ù…Ø±Ø§Ø¯Ù¾ÙˆØ±","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"0082878110","name":"Ø§Ù„Ù†Ø§Ø² Ù†ÙˆØ±ÙˆØ²ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"5449975856","name":"ÙˆÙ„ÛŒ Ø§Ù„Ù‡ ØºÙ†Ø¬ÛŒ ÙØ´Ú©ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"0013322214","name":"Ø²Ù‡Ø±Ø§ Ø¨Ø§Ø¨Ø§ÛŒÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"0076209441","name":"Ù…Ø­Ù…Ø¯ Ù¾ÙˆØ±ÛŒØ§Ù†ÙØ±","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"0013227173","name":"Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† ØµØ§Ø¯Ù‚ Ù†Ú˜Ø§Ø¯","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"0014880751","name":"Ø­Ø³Ø§Ù… ÙÙ„Ø§Ø­Øª Ù¾ÛŒØ´Ù‡","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"1360830634","name":"Ù…Ù‡Ø±Ø¯Ø§Ø¯ ØµØ§Ø¨Ø± Ù‚Ø±Ù‡ Ø¨Ø§Ø¨Ø§","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"4232135855","name":"Ù…Ø­Ù…Ø¯ ØµÛŒØ§Ø¯ÛŒ Ø³ÛŒ Ø³Ø®Øª","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"2980435430","name":"ÙØ§Ø¦Ø²Ù‡ Ø¨Ø§Ù‚Ø±ÛŒ Ù¾ÙˆØ±","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"1465352864","name":"Ø±ÙˆØ´Ù†Ú© Ù…Ø­Ù…Ø¯ÛŒØ§Ù†","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"0451327926","name":"Ù„ÛŒÙ„Ø§ Ø§Ø­Ù…Ø¯ÛŒ Ø¢ÙˆØ±Ø²Ù…Ø§Ù†","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"0310669081","name":"Ù…Ø±ØªØ¶ÛŒ Ù†ÛŒÚ©ÙˆØ¦ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"0084697377","name":"Ù…Ø±ØªØ¶ÛŒ Ø´Ø§Ù‡ Ù…Ø­Ù…Ø¯ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"4560132534","name":"Ù¾Ø¯Ø±Ø§Ù… Ø¹Ø¨Ø¯Ø§Ù„Ù‡ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"2471739113","name":"Ø¹Ø§Ø·ÙÙ‡ Ø³Ø±Ù…Ø¯","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"0071114671","name":"Ø¹Ø±ÙØ§Ù†Ù‡ Ø³Ø§Ø¯Ø§Øª ÛŒØ²Ø¯Ø§Ù†Ø´Ù†Ø§Ø³","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"0058084411","name":"ÛŒØ¹Ù‚ÙˆØ¨ Ø±Ø­ÛŒÙ…ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"2050322747","name":"Ø¹Ù„ÛŒØ±Ø¶Ø§ Ø´Ú©Ø± Ø§Ù„Ù‡ Ù†ÛŒØ§ Ø±ÙˆØ´Ù†","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"0018553771","name":"ØµØ¯Ù Ø¹Ù„ÛŒ Ù†Ú˜Ø§Ø¯","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"2080284665","name":"Ø·Ù‡ Ø¨Ø§Ù„Ø§ÛŒÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"0019294638","name":"Ù¾Ú¯Ø§Ù‡ Ú©Ø±ÛŒÙ…ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 0"},
 {"code":"1742478638","name":"Ù„ÛŒÙ„Ø§ Ù…Ù†ÛŒØ´ Ø¯Ø§ÙˆÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 0"},
 {"code":"4592243331","name":"Ø±Ø¶Ø§ Ø¯Ø§ÙˆØ±Ù¾Ù†Ø§Ù‡","section":"Ø·Ø¨Ù‚Ù‡ 0"},
 {"code":"0059433876","name":"Ø¯Ø§ÙˆØ¯ Ø¯Ù„Ø§ÙˆØ±ÛŒ Ù¾Ø§Ø±Ø³Ø§","section":"Ø·Ø¨Ù‚Ù‡ 0"},
 {"code":"0025204599","name":"Ø¹Ù„ÛŒ Ø§Ø³Ú©Ù†Ø¯Ø±ÛŒ Ù†ØµÙÚ†ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"0011911131","name":"Ù…Ø­Ù…Ø¯ ØµØ§Ø¯Ù‚ Ø±ÙÛŒØ¹ Ù¾ÙˆÛŒØ§","section":"Ø·Ø¨Ù‚Ù‡ 3"},
 {"code":"0682486401","name":"Ú©Ø§ÙˆÙ‡ Ø±Ø¬Ø¨ Ù¾ÙˆØ± Ù…Ù‚Ø¯Ù…","section":"Ø·Ø¨Ù‚Ù‡ 2"},
 {"code":"0023475919","name":"Ø²Ù‡Ø±Ø§ ÙÛŒÙ„Ø³ÙˆÙÛŒØ§Ù†","section":"Ø·Ø¨Ù‚Ù‡ 1"},
 {"code":"5669148134","name":"Ø­Ù‚ÛŒÙ‚Øª Ù†ÙˆØ±ÙˆØ²ÛŒ","section":"Ø·Ø¨Ù‚Ù‡ 2"}
];

let monthMenu = { weeks:{}, sideItems:[], holidays:[] };
let currentUser = null;

/* Ø§Ø¨Ø²Ø§Ø± Ø´Ù…Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ù…Ø±ÙˆØ² */
function toJalali(gY,gM,gD){
  const gdm=[31,28,31,30,31,30,31,31,30,31,30,31], jdm=[31,31,31,31,31,31,30,30,30,30,30,29];
  let gy=gY-1600, gm=gM-1, gd=gD-1, gDayNo=365*gy+Math.floor((gy+3)/4)-Math.floor((gy+99)/100)+Math.floor((gy+399)/400);
  for(let i=0;i<gm;++i) gDayNo+=gdm[i];
  if(gm>1 && ((gY%4===0 && gY%100!==0)||(gY%400===0))) gDayNo++;
  gDayNo+=gd;
  let jDayNo=gDayNo-79, jNp=Math.floor(jDayNo/12053); jDayNo%=12053;
  let jy=979+33*jNp+4*Math.floor(jDayNo/1461); jDayNo%=1461;
  if(jDayNo>=366){ jy+=Math.floor((jDayNo-366)/365); jDayNo=(jDayNo-366)%365; }
  let jm=0; for(;jm<11 && jDayNo>=jdm[jm]; ++jm) jDayNo-=jdm[jm];
  let jd=jDayNo+1; return {jy, jm:jm+1, jd};
}
function todayText(){
  const d=new Date(); const j=toJalali(d.getFullYear(),d.getMonth()+1,d.getDate());
  const pad=n=>String(n).padStart(2,"0"); return `${j.jy}/${pad(j.jm)}/${pad(j.jd)}`;
}

/* Ø®ÙˆØ§Ù†Ø¯Ù† menu.json (RAW) */
async function fetchMenuJSON(){
  const res = await fetch(MENU_JSON_URL + "?" + Date.now());
  if(!res.ok){ throw new Error("menu.json not found"); }
  const json = await res.json();
  if(json.weeks){
    monthMenu.weeks = json.weeks || {};
    monthMenu.sideItems = json.sideItems || [];
    monthMenu.holidays = json.holidays || [];
  }else if(json.weeklyMenu){
    monthMenu.weeks = { "Ù‡ÙØªÙ‡ 1": {} };
    Object.keys(json.weeklyMenu).forEach(k=>{
      // Ø§Ú¯Ø± ÙÙ‚Ø· Ù†Ø§Ù… Ø±ÙˆØ² Ø§Ø³ØªØŒ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ù‡Ù…Ø§Ù† Ø±Ø§ Ú©Ù„ÛŒØ¯ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
      monthMenu.weeks["Ù‡ÙØªÙ‡ 1"][k] = json.weeklyMenu[k];
    });
    monthMenu.sideItems = json.sideItems || [];
    monthMenu.holidays = [];
  }else{
    monthMenu = {weeks:{}, sideItems:[], holidays:[]};
  }
}

/* ÙˆØ±ÙˆØ¯ */
async function login(){
  const code = document.getElementById("userCode").value.trim();
  if(!code){ document.getElementById("loginMsg").textContent="Ú©Ø¯ Ù…Ù„ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯."; return; }

  try{ await fetchMenuJSON(); }catch(e){
    document.getElementById("loginMsg").textContent="Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ù†Ùˆ Ø§Ø² menu.json Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯.";
    return;
  }

  if(code==="admin"){
    currentUser = {code:"admin", name:"Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…", section:""};
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("adminDiv").style.display="block";
    document.getElementById("whoAmI").textContent = "Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…";
    document.getElementById("jsonPreview").textContent = JSON.stringify(monthMenu, null, 2);
    return;
  }

  const u = users.find(x=>x.code===code);
  if(!u){ document.getElementById("loginMsg").textContent="Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª!"; return; }
  currentUser = u;
  document.getElementById("loginDiv").style.display="none";
  document.getElementById("orderDiv").style.display="block";
  document.getElementById("helloText").textContent = `Ø³Ù„Ø§Ù… ${u.name} (${u.section})`;
  document.getElementById("whoAmI").textContent = `${u.name} â€¢ ${u.section}`;
  renderMonthForm();
}

/* Ø®Ø±ÙˆØ¬ */
function logout(){
  currentUser = null;
  document.getElementById("orderDiv").style.display="none";
  document.getElementById("adminDiv").style.display="none";
  document.getElementById("loginDiv").style.display="block";
  document.getElementById("whoAmI").textContent="";
  document.getElementById("orderMsg").textContent="";
}

/* ÙØ±Ù… Ù…Ø§Ù‡Ø§Ù†Ù‡: Ø¨Ø± Ø§Ø³Ø§Ø³ weeks Ùˆ holidays Ø¯Ø± JSON */
function renderMonthForm(){
  const container = document.getElementById("monthContainer");
  container.innerHTML = "";
  const sideItems = monthMenu.sideItems || [];
  let monthTitle = "";

  const weekKeys = Object.keys(monthMenu.weeks||{}).sort((a,b)=>{
    const na = parseInt((a.match(/\d+/)||[0])[0],10);
    const nb = parseInt((b.match(/\d+/)||[0])[0],10);
    return na-nb;
  });

  weekKeys.forEach((wkKey, wIdx)=>{
    const weekObj = monthMenu.weeks[wkKey] || {};
    const card = document.createElement("div");
    card.className = "week-card";

    const dayKeys = Object.keys(weekObj);
    const first = dayKeys[0] || "";
    const last  = dayKeys[dayKeys.length-1] || "";
    const range = (first && last) ? `${first.split(" ")[0]} ØªØ§ ${last.split(" ")[0]}` : "";

    if(!monthTitle && first){ monthTitle = first.split("/").slice(0,2).join("/"); }

    card.innerHTML = `<div class="week-title">${wkKey} ${range ? "â€” " + range : ""}</div>`;

    dayKeys.forEach((label, dIdx)=>{
      const parts = label.split(" "); // "YYYY/MM/DD Ø´Ù†Ø¨Ù‡"
      const jdate = parts[0] || "";
      const dayName = parts[1] || "";
      const isHoliday = (monthMenu.holidays||[]).includes(jdate) || /Ø¬Ù…Ø¹Ù‡|Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡/.test(dayName);

      const meals = weekObj[label] || {Ø®ÙˆØ±Ø§Ú©:"-",Ú©Ø¨Ø§Ø¨ÛŒ:"-",Ø®ÙˆØ±Ø´ØªÛŒ:"-"};

      const row = document.createElement("div");
      row.className = "row";
      row.innerHTML = `
        <div class="grid-day ${isHoliday ? "disabled" : ""}">
          <div class="badge ${isHoliday ? "strike": ""}" data-day="${dayName}">${label}</div>
          <select id="meal_${wIdx}_${dIdx}" class="select" ${isHoliday?"disabled":""}>
            <option value="${meals.Ø®ÙˆØ±Ø§Ú©}">${meals.Ø®ÙˆØ±Ø§Ú©} (Ø®ÙˆØ±Ø§Ú©)</option>
            <option value="${meals.Ú©Ø¨Ø§Ø¨ÛŒ}">${meals.Ú©Ø¨Ø§Ø¨ÛŒ} (Ú©Ø¨Ø§Ø¨ÛŒ)</option>
            <option value="${meals.Ø®ÙˆØ±Ø´ØªÛŒ}">${meals.Ø®ÙˆØ±Ø´ØªÛŒ} (Ø®ÙˆØ±Ø´ØªÛŒ)</option>
          </select>
          <select id="side_${wIdx}_${dIdx}" class="select" ${isHoliday?"disabled":""}>
            ${sideItems.map(s=>`<option value="${s}">${s}</option>`).join("")}
          </select>
        </div>`;
      card.appendChild(row);
    });

    container.appendChild(card);
  });

  document.getElementById("monthTitle").textContent = monthTitle ? `Ù…Ø§Ù‡ ${monthTitle}` : "Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ";
}

/* Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ§Ø±Ø´ Ù…Ø§Ù‡ (Local Ø¯Ø± Ø¯Ø³ØªÚ¯Ø§Ù‡ ÙØ¹Ù„ÛŒ) */
function submitMonthOrder(){
  if(!currentUser){ return; }
  const container = document.getElementById("monthContainer");
  const rows = container.querySelectorAll(".week-card .row");

  const orders = [];
  rows.forEach((row)=>{
    const grid = row.querySelector(".grid-day");
    if(grid.classList.contains("disabled")) return; // ØªØ¹Ø·ÛŒÙ„â€ŒÙ‡Ø§ Ø­Ø°Ù

    const badge = row.querySelector(".badge");
    const label = badge?.textContent?.trim() || "";
    const selects = row.querySelectorAll("select");
    if(selects.length<2) return;
    const meal = selects[0].value;
    const side = selects[1].value;
    orders.push({ label, meal, side });
  });

  const key = `order_month_${currentUser.code}_${Date.now()}`;
  const payload = {
    code: currentUser.code,
    name: currentUser.name,
    section: currentUser.section,
    orders
  };
  localStorage.setItem(key, JSON.stringify(payload));
  document.getElementById("orderMsg").textContent = "Ø³ÙØ§Ø±Ø´ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø«Ø¨Øª Ø´Ø¯ âœ…";
}

/* Ø§Ø¨Ø²Ø§Ø± Ù…Ø¯ÛŒØ± Ø¨Ø±Ø§ÛŒ JSON */
function openMenuOnGitHub(){
  const url = MENU_JSON_URL.replace("raw.githubusercontent.com","github.com").replace("/main/","/blob/main/");
  window.open(url, "_blank");
}
function copyRawMenuLink(){
  navigator.clipboard?.writeText(MENU_JSON_URL);
  alert("Copied:\n"+MENU_JSON_URL);
}

/* Ø¨ÙˆØª */
(function boot(){
  document.getElementById("todayBar").textContent = "Ø§Ù…Ø±ÙˆØ² (Ø´Ù…Ø³ÛŒ): " + todayText();
})();
</script>

</body>
</html>
