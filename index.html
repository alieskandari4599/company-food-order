<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø³ÙØ§Ø±Ø´ ØºØ°Ø§ÛŒ Ø´Ø±Ú©Øª</title>
  <style>
    :root{
      --bg:#0f172a; --card:rgba(255,255,255,.08); --card-border:rgba(255,255,255,.18);
      --text:#e6edf6; --muted:#b6c2d9; --accent:#22c55e; --accent-strong:#16a34a;
      --danger:#ef4444; --ok:#34d399; --shadow:0 10px 30px rgba(0,0,0,.25); --radius:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Tahoma,system-ui;background:var(--bg);color:var(--text);line-height:1.7;}
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);
      background:linear-gradient(180deg,rgba(15,23,42,.95),rgba(15,23,42,.75));
      border-bottom:1px solid rgba(255,255,255,.08);}
    .nav{max-width:1100px;margin:auto;padding:16px 20px;display:flex;justify-content:space-between;align-items:center}
    .brand{font-weight:800;font-size:20px}
    #whoAmI{color:var(--muted);font-size:14px}
    .container{max-width:1100px;margin:28px auto;padding:0 20px}
    .card{background:var(--card);border:1px solid var(--card-border);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;text-align:center}
    h2{margin:6px 0 16px;font-size:22px}
    .muted{color:var(--muted);font-size:15px}
    .field{margin:14px 0}
    .input,.select,.button{
      width:100%;padding:14px 16px;font-size:16px;border-radius:14px;
      border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.07);
      color:var(--text);outline:none;transition:all .2s}
    .select{appearance:none;text-align:center;font-weight:bold;}
    .button{background:linear-gradient(180deg,var(--accent),var(--accent-strong));border:none;
      cursor:pointer;font-weight:700;transition:transform .15s}
    .button:hover{transform:translateY(-2px);filter:brightness(1.05);}
    .danger{background:linear-gradient(180deg,var(--danger),#b91c1c)!important;}
    .day{display:grid;gap:12px;grid-template-columns:210px 1fr 220px;align-items:center;margin:10px 0}
    @media (max-width:900px){.day{grid-template-columns:1fr}}
    .badge{padding:10px 12px;border-radius:12px;font-weight:800;text-align:center;
      background:rgba(255,255,255,.06);border:1px solid var(--card-border)}
    .holiday{opacity:.65;text-decoration:line-through;filter:grayscale(.3)}
    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:14px;overflow:hidden;border-radius:14px}
    thead th{position:sticky;top:0;z-index:1;background:rgba(255,255,255,.08);backdrop-filter:blur(8px)}
    th,td{border-bottom:1px solid rgba(255,255,255,.08);padding:10px;text-align:center;font-size:14px}
    tbody tr:nth-child(odd){background:rgba(255,255,255,.04)} tbody tr:hover{background:rgba(255,255,255,.07)}
    .row{display:grid;gap:12px}
    .two{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    @media (max-width:900px){.two{grid-template-columns:1fr}}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--card-border);background:rgba(255,255,255,.06);font-size:12px;margin:3px}
    #legend{text-align:right;margin-top:10px}
  </style>
</head>
<body>

<header>
  <div class="nav">
    <div class="brand">ğŸ½ï¸ Ø³Ø§Ù…Ø§Ù†Ù‡ Ø³ÙØ§Ø±Ø´ ØºØ°Ø§ÛŒ Ø´Ø±Ú©Øª</div>
    <div id="whoAmI"></div>
  </div>
</header>

<div class="container">
  <!-- ÙˆØ±ÙˆØ¯ -->
  <div class="card" id="loginDiv">
    <h2>ÙˆØ±ÙˆØ¯</h2>
    <p class="muted">Ú©Ø¯ Ù…Ù„ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø¯ÛŒØ±: <b>admin</b>)</p>
    <div class="field"><input id="userCode" class="input" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 0012345678 ÛŒØ§ admin" /></div>
    <button class="button" onclick="login()">ÙˆØ±ÙˆØ¯</button>
    <p id="loginMsg" style="color:#ff6b6b"></p>
  </div>

  <!-- Ø§Ù†ØªØ®Ø§Ø¨ ØºØ°Ø§ -->
  <div class="card" id="orderDiv" style="display:none;">
    <h2>Ø§Ù†ØªØ®Ø§Ø¨ ØºØ°Ø§ (Û¸ ØªØ§ Û²Û± Ø´Ù‡Ø±ÛŒÙˆØ±)</h2>
    <p id="helloText" class="muted"></p>
    <div id="legend"></div>
    <div id="daysContainer"></div>
    <div class="two" style="margin-top:14px">
      <button class="button" onclick="submitOrder()">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
      <button class="button danger" onclick="logout()">Ø®Ø±ÙˆØ¬ / Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <p id="orderMsg" style="color:#34d399"></p>
  </div>

  <!-- Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ± -->
  <div class="card" id="adminDiv" style="display:none;">
    <h2>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
    <div id="legendAdmin"></div>

    <div class="two" style="margin-top:8px">
      <div>
        <label class="muted">ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ø®Ø´</label>
        <select id="sectionFilter" class="select" onchange="renderOrdersTable()">
          <option value="Ù‡Ù…Ù‡">Ù‡Ù…Ù‡</option>
        </select>
      </div>
      <div class="row">
        <button class="button" onclick="exportDailyByFloor()">ğŸ“¥ CSV Ø±ÙˆØ²Ø§Ù†Ù‡ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ø·Ø¨Ù‚Ù‡</button>
      </div>
    </div>

    <table id="ordersTable">
      <thead>
        <tr>
          <th>Ú©Ø¯ Ù…Ù„ÛŒ</th><th>Ù†Ø§Ù…</th><th>Ø¨Ø®Ø´</th>
          <th>ØªØ§Ø±ÛŒØ®</th><th>Ø³ÙØ§Ø±Ø´</th><th>Ú©Ù†Ø§Ø± ØºØ°Ø§</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="row" style="margin-top:12px">
      <button class="button danger" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
</div>

<script>
/* ===== Ú©Ø§Ø±Ú©Ù†Ø§Ù† (Ú©Ø§Ù…Ù„) ===== */
const users = [
 {code:"1465316159",name:"Ø¹Ù„ÛŒ Ø§ØµØºØ±Ø²Ø§Ø¯Ù‡ ØµØ§Ø¯Ù‚",section:"Ø·Ø¨Ù‚Ù‡ 4"},
 {code:"0939825902",name:"Ø³ÛŒØ¯ Ø¹Ù„ÛŒ Ù…ÛŒØ±ØªÙˆÙ†ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 4"},
 {code:"0075102110",name:"Ù…Ø­Ø³Ù† Ø§Ø´Ø±Ù Ø§Ø³Ù„Ø§Ù…ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 4"},
 {code:"1532626142",name:"Ø²Ù‡Ø±Ø§ Ù…Ø­Ù…Ø¯ÛŒ Ø­Ù„Ù…Ø³Ù„ÙˆØ¦ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 4"},
 {code:"2710033445",name:"Ù…Ø³Ø¹ÙˆØ¯ Ù‚Ø§Ø³Ù… Ø²Ø§Ø¯Ù‡ Ø³ÛŒØ§Ù‡Ú©Ù„",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"1263594301",name:"Ù…Ù‡Ø¯ÛŒ Ù†ÙˆØ±ÙˆØ²ÛŒ Ø®Ø²Ø§Ù‚ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"0010275975",name:"Ù„ÛŒÙ„Ø§ Ø±Ø³ÙˆÙ„ÛŒ Ø¯Ø±Ø¢Ø¨Ø§Ø¯",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"0014668688",name:"Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ø¹Ø¨Ø¯Ø§Ù„Ù‡ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"0051385090",name:"Ø´Ø§Ù‡ÛŒÙ† ÙØ§Ø¶Ù„ Ù…Ù‡Ø±",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"1450551394",name:"ÙØ§Ø·Ù…Ù‡ Ù¾Ø§Ø±Ø³Ø§ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"1263591310",name:"Ù…Ù‚Ø¯Ø§Ø¯ Ø´ÙÙ‚ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"0020090641",name:"ÙØ§Ø·Ù…Ù‡ Ù…ÛŒØ±Ø²Ø§Ø®Ø§Ù†ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"0077320980",name:"Ø¬ÙˆØ§Ø¯ Ù…Ø±Ø§Ø¯Ù¾ÙˆØ±",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"0082878110",name:"Ø§Ù„Ù†Ø§Ø² Ù†ÙˆØ±ÙˆØ²ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"5449975856",name:"ÙˆÙ„ÛŒ Ø§Ù„Ù‡ ØºÙ†Ø¬ÛŒ ÙØ´Ú©ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"0013322214",name:"Ø²Ù‡Ø±Ø§ Ø¨Ø§Ø¨Ø§ÛŒÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"0076209441",name:"Ù…Ø­Ù…Ø¯ Ù¾ÙˆØ±ÛŒØ§Ù†ÙØ±",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"0013227173",name:"Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† ØµØ§Ø¯Ù‚ Ù†Ú˜Ø§Ø¯",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"0014880751",name:"Ø­Ø³Ø§Ù… ÙÙ„Ø§Ø­Øª Ù¾ÛŒØ´Ù‡",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"1360830634",name:"Ù…Ù‡Ø±Ø¯Ø§Ø¯ ØµØ§Ø¨Ø± Ù‚Ø±Ù‡ Ø¨Ø§Ø¨Ø§",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"4232135855",name:"Ù…Ø­Ù…Ø¯ ØµÛŒØ§Ø¯ÛŒ Ø³ÛŒ Ø³Ø®Øª",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"2980435430",name:"ÙØ§Ø¦Ø²Ù‡ Ø¨Ø§Ù‚Ø±ÛŒ Ù¾ÙˆØ±",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"1465352864",name:"Ø±ÙˆØ´Ù†Ú© Ù…Ø­Ù…Ø¯ÛŒØ§Ù†",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"0451327926",name:"Ù„ÛŒÙ„Ø§ Ø§Ø­Ù…Ø¯ÛŒ Ø¢ÙˆØ±Ø²Ù…Ø§Ù†",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"0310669081",name:"Ù…Ø±ØªØ¶ÛŒ Ù†ÛŒÚ©ÙˆØ¦ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"0084697377",name:"Ù…Ø±ØªØ¶ÛŒ Ø´Ø§Ù‡ Ù…Ø­Ù…Ø¯ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"4560132534",name:"Ù¾Ø¯Ø±Ø§Ù… Ø¹Ø¨Ø¯Ø§Ù„Ù‡ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"2471739113",name:"Ø¹Ø§Ø·ÙÙ‡ Ø³Ø±Ù…Ø¯",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"0071114671",name:"Ø¹Ø±ÙØ§Ù†Ù‡ Ø³Ø§Ø¯Ø§Øª ÛŒØ²Ø¯Ø§Ù†Ø´Ù†Ø§Ø³",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"0058084411",name:"ÛŒØ¹Ù‚ÙˆØ¨ Ø±Ø­ÛŒÙ…ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"2050322747",name:"Ø¹Ù„ÛŒØ±Ø¶Ø§ Ø´Ú©Ø± Ø§Ù„Ù‡ Ù†ÛŒØ§ Ø±ÙˆØ´Ù†",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"0018553771",name:"ØµØ¯Ù Ø¹Ù„ÛŒ Ù†Ú˜Ø§Ø¯",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"2080284665",name:"Ø·Ù‡ Ø¨Ø§Ù„Ø§ÛŒÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"0019294638",name:"Ù¾Ú¯Ø§Ù‡ Ú©Ø±ÛŒÙ…ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 0"},
 {code:"1742478638",name:"Ù„ÛŒÙ„Ø§ Ù…Ù†ÛŒØ´ Ø¯Ø§ÙˆÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 0"},
 {code:"4592243331",name:"Ø±Ø¶Ø§ Ø¯Ø§ÙˆØ±Ù¾Ù†Ø§Ù‡",section:"Ø·Ø¨Ù‚Ù‡ 0"},
 {code:"0059433876",name:"Ø¯Ø§ÙˆØ¯ Ø¯Ù„Ø§ÙˆØ±ÛŒ Ù¾Ø§Ø±Ø³Ø§",section:"Ø·Ø¨Ù‚Ù‡ 0"},
 {code:"0025204599",name:"Ø¹Ù„ÛŒ Ø§Ø³Ú©Ù†Ø¯Ø±ÛŒ Ù†ØµÙÚ†ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"0011911131",name:"Ù…Ø­Ù…Ø¯ ØµØ§Ø¯Ù‚ Ø±ÙÛŒØ¹ Ù¾ÙˆÛŒØ§",section:"Ø·Ø¨Ù‚Ù‡ 3"},
 {code:"0682486401",name:"Ú©Ø§ÙˆÙ‡ Ø±Ø¬Ø¨ Ù¾ÙˆØ± Ù…Ù‚Ø¯Ù…",section:"Ø·Ø¨Ù‚Ù‡ 2"},
 {code:"0023475919",name:"Ø²Ù‡Ø±Ø§ ÙÛŒÙ„Ø³ÙˆÙÛŒØ§Ù†",section:"Ø·Ø¨Ù‚Ù‡ 1"},
 {code:"5669148134",name:"Ø­Ù‚ÛŒÙ‚Øª Ù†ÙˆØ±ÙˆØ²ÛŒ",section:"Ø·Ø¨Ù‚Ù‡ 2"}
];

const SIDE_ITEMS = ["Ù†ÙˆØ´Ø§Ø¨Ù‡","Ø¯ÙˆØº","Ø³Ø§Ù„Ø§Ø¯ ÙØµÙ„"];
const MENU_KEYS  = ["Ù†ÙˆØ¹ Ø§ÙˆÙ„","Ù†ÙˆØ¹ Ø¯ÙˆÙ…","Ù†ÙˆØ¹ Ø³ÙˆÙ…"]; // Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù…Ù†Ùˆ
let MENU = {};   // Ø§Ø² menu.json Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯

/* ---------- menu.json ---------- */
async function loadMenu(){
  try{
    const r = await fetch('menu.json', {cache:'no-store'});
    if(!r.ok) throw new Error(r.status);
    MENU = await r.json();
  }catch(e){
    alert('menu.json Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ ÛŒØ§ JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.');
    MENU = {};
  }
}
function renderLegend(){
  const pills = Object.keys(MENU).map(d=>{
    return MENU[d].ØªØ¹Ø·ÛŒÙ„
      ? `<span class="pill holiday">${d} (ØªØ¹Ø·ÛŒÙ„)</span>`
      : `<span class="pill">${d}</span>`;
  }).join("");
  const lg1 = document.getElementById("legend");
  const lg2 = document.getElementById("legendAdmin");
  if(lg1) lg1.innerHTML = pills;
  if(lg2) lg2.innerHTML = pills;
}

/* ---------- ÙˆØ±ÙˆØ¯/Ø®Ø±ÙˆØ¬ ---------- */
async function login(){
  const code = document.getElementById("userCode").value.trim();
  if(code==="admin"){
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("adminDiv").style.display="block";
    document.getElementById("whoAmI").textContent="Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…";
    await loadMenu(); renderLegend(); populateSectionFilter(); renderOrdersTable();
    return;
  }
  const u = users.find(x=>x.code===code);
  if(!u){ document.getElementById("loginMsg").textContent="Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª!"; return; }

  localStorage.setItem("currentUser", u.code);
  localStorage.setItem("currentUserName", u.name);
  localStorage.setItem("currentUserSection", u.section);

  document.getElementById("loginDiv").style.display="none";
  document.getElementById("orderDiv").style.display="block";
  document.getElementById("whoAmI").textContent = `${u.name} â€¢ ${u.section}`;
  document.getElementById("helloText").textContent = `Ø³Ù„Ø§Ù… ${u.name}! Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±ÙˆØ² ÛŒÚ© Ø¢ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†.`;

  await loadMenu(); renderLegend(); renderOrderForm();
}
function logout(){
  document.getElementById("loginDiv").style.display="block";
  document.getElementById("orderDiv").style.display="none";
  document.getElementById("adminDiv").style.display="none";
  document.getElementById("whoAmI").textContent="";
}

/* ---------- ÙØ±Ù… Ø³ÙØ§Ø±Ø´ (Ø¨Ø§ Ù†ÙˆØ¹ Ø§ÙˆÙ„/Ø¯ÙˆÙ…/Ø³ÙˆÙ…) ---------- */
function buildOptionsFromMenuItem(item){
  return MENU_KEYS
    .filter(k => Object.prototype.hasOwnProperty.call(item,k))
    .map(k => {
      const label = item[k];
      return `<option value="${label}">${label} (${k})</option>`;
    }).join("");
}
function renderOrderForm(){
  const c = document.getElementById("daysContainer");
  c.innerHTML = "";
  const dates = Object.keys(MENU).sort(); // ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨

  dates.forEach(dateLabel=>{
    const item = MENU[dateLabel];

    // ØªØ¹Ø·ÛŒÙ„
    if(item.ØªØ¹Ø·ÛŒÙ„){
      const wrap = document.createElement("div");
      wrap.className = "day holiday";
      wrap.innerHTML = `<div class="badge">${dateLabel}</div><div style="text-align:right">ØªØ¹Ø·ÛŒÙ„</div><div></div>`;
      c.appendChild(wrap);
      return;
    }

    // Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ
    const idSafe = dateLabel.replace(/\s+/g,"_");
    const wrap = document.createElement("div");
    wrap.className = "day";
    wrap.innerHTML = `
      <div class="badge">${dateLabel}</div>
      <select id="meal_${idSafe}" class="select">${buildOptionsFromMenuItem(item)}</select>
      <select id="side_${idSafe}" class="select">
        ${SIDE_ITEMS.map(s=>`<option value="${s}">${s}</option>`).join("")}
      </select>
    `;
    c.appendChild(wrap);
  });
}

/* ---------- Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ§Ø±Ø´ (Ù„ÙˆÚ©Ø§Ù„) ---------- */
function submitOrder(){
  const code = localStorage.getItem("currentUser");
  const section = localStorage.getItem("currentUserSection") || "";
  if(!code){ alert("Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯."); return; }

  let prev = {};
  try{ prev = JSON.parse(localStorage.getItem("order_"+code) || "{}"); }catch{ prev = {}; }

  Object.keys(MENU).forEach(dateLabel=>{
    const itm = MENU[dateLabel];
    if(itm.ØªØ¹Ø·ÛŒÙ„) return;
    const key = dateLabel.replace(/\s+/g,"_");
    const mealSel = document.getElementById("meal_"+key);
    const sideSel = document.getElementById("side_"+key);
    prev[dateLabel] = { meal: mealSel?.value || "", side: sideSel?.value || "", section };
  });

  localStorage.setItem("order_"+code, JSON.stringify(prev));
  document.getElementById("orderMsg").textContent = "Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯ âœ…";
}

/* ---------- Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±: Ø¬Ø¯ÙˆÙ„ + Ø®Ø±ÙˆØ¬ÛŒ CSV ---------- */
function populateSectionFilter(){
  const select = document.getElementById("sectionFilter");
  const sections = [...new Set(users.map(u=>u.section))];
  sections.forEach(sec=>{
    const op = document.createElement("option");
    op.value = sec; op.textContent = sec;
    select.appendChild(op);
  });
}
function renderOrdersTable(){
  const tbody = document.querySelector("#ordersTable tbody");
  tbody.innerHTML = "";
  const filter = document.getElementById("sectionFilter").value;

  users.forEach(u=>{
    const data = JSON.parse(localStorage.getItem("order_"+u.code) || "{}");
    Object.keys(data).forEach(date=>{
      const v = data[date];
      const section = v.section || u.section;
      if(filter!=="Ù‡Ù…Ù‡" && section!==filter) return;
      tbody.insertAdjacentHTML("beforeend",
        `<tr>
          <td>${u.code}</td><td>${u.name}</td><td>${section}</td>
          <td>${date}</td><td>${v.meal||""}</td><td>${v.side||""}</td>
        </tr>`
      );
    });
  });
}
function exportDailyByFloor(){
  const dateLabel = prompt("ØªØ§Ø±ÛŒØ® Ø¯Ù‚ÛŒÙ‚ Ù…Ø«Ù„ menu.json Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù† (Ù…Ø«Ù„Ø§Ù‹: 1404/06/11):");
  if(!dateLabel || !MENU[dateLabel]){ alert("ØªØ§Ø±ÛŒØ® Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ø¯Ø± Ù…Ù†Ùˆ Ù†ÛŒØ³Øª."); return; }

  const floors = [...new Set(users.map(u=>u.section))].sort();
  let csv = "Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ø·Ø¨Ù‚Ù‡\n";
  floors.forEach(floor=>{
    csv += `\n${floor}\nÚ©Ø¯ Ù…Ù„ÛŒ,Ù†Ø§Ù…,Ø¨Ø®Ø´,ØªØ§Ø±ÛŒØ®,Ø³ÙØ§Ø±Ø´,Ú©Ù†Ø§Ø± ØºØ°Ø§\n`;
    users.forEach(u=>{
      if(u.section !== floor) return;
      const data = JSON.parse(localStorage.getItem("order_"+u.code) || "{}");
      const cell = data[dateLabel];
      if(cell){
        csv += `${u.code},${u.name},${floor},${dateLabel},${cell.meal||""},${cell.side||""}\n`;
      }
    });
  });

  const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `orders_daily_${dateLabel.replace(/\s+/g,'_')}.csv`;
  a.click();
}

/* ---------- Ø¨ÙˆØª ---------- */
(async function boot(){ await loadMenu(); renderLegend(); })();

</script>
</body>
</html>
